# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Interactive redistricting/gerrymandering simulator. Users paint congressional districts on a hex-tile map and observe how boundary placement affects electoral outcomes in real time. Zero dependencies — vanilla HTML/CSS/JS with SVG rendering.

## Running Locally

No build step. Serve with any static HTTP server:
```bash
python -m http.server 8000
# or
npx serve .
```
Open `http://localhost:8000`. There is no package.json, no test suite, and no linter configured.

## Architecture

Three files: `index.html`, `script.js` (1030 lines), `styles.css` (667 lines).

### State Management (script.js)

All application state lives in a single `state` object:
- `hexes` (Map): hex tiles keyed by `"q,r"` axial coordinates, each storing population, party votes, district assignment, and demographic data
- `districts` (Object): 10 districts with computed metrics (population, votes, winner, compactness, contiguity)
- Undo/redo stacks (50-level deep snapshots of hex→district assignments)
- Viewport state (viewBox, zoomLevel, pan position)

### Data Flow

```
User input (mouse/keyboard) → Paint/Erase/Zoom handler → Mutate state
→ recalculate metrics & winners → re-render SVG + sidebar → push undo snapshot
```

### Key Algorithms

- **Hex grid**: Axial coordinate system (q, r, s). `hexToPixel()` / `hexCorners()` convert to SVG positions. Grid is ~18×25 hexes with an organic boundary generated by trigonometric noise.
- **Population generation**: Gaussian decay from randomly placed cities/towns. Urban hexes skew Blue, rural skew Red, with a Yellow third party.
- **Efficiency gap**: Wasted-vote analysis (Red vs Blue only). Positive = favors Blue, negative = favors Red.
- **Compactness**: Polsby-Popper method (4π × area / perimeter²).
- **Contiguity**: BFS flood-fill from an arbitrary hex in each district; valid if all district hexes are reachable.
- **District borders**: Extract boundary edges between differently-assigned hexes, chain into continuous SVG paths, clip to district regions.

### Styling (styles.css)

CSS custom properties on `:root` control theming. Party colors: Red (#b80f2a/#e83856), Blue (#0b429c/#4d88e8), Yellow (#e6a800). Minority-majority overlay is green (#3a8a50). Typography uses Google Fonts: Instrument Serif (headings), Geist Mono (body), Geist Sans (UI).

### User Interactions

- Left-click: assign hex to current district (with 110% population cap)
- Right-click: erase hex assignment
- Scroll wheel: zoom (0.3x–3x)
- Middle-click drag: pan
- Ctrl+Z / Ctrl+Y: undo/redo
- Delete mode: toggle button for bulk district erasure
